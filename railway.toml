[build]
builder = "nixpacks"

[deploy]
startCommand = "gunicorn -w 4 -b 0.0.0.0:${PORT:-8080} --timeout 300 --log-level info web.app:app"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

[healthcheck]
path = "/health"
timeout = 100

[[services]]
name = "web"
command = "gunicorn -w 4 -b 0.0.0.0:${PORT:-8080} --timeout 300 --log-level info web.app:app"

[[services]]
name = "worker"
command = "celery -A web.celery_app worker --loglevel=info --concurrency=4"
